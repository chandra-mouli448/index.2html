<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Decentralized P2P Lending DApp</title>
</head>
<body>
    <h2>Decentralized Peer-to-Peer Lending</h2>

    <button onclick="connect()">Connect Wallet</button>
    <p id="account"></p>

    <h3>Request Loan</h3>
    Amount (wei): <input id="amount" type="text"><br>
    Interest (%): <input id="interest" type="text"><br>
    Duration (seconds): <input id="duration" type="text"><br>
    <button onclick="requestLoan()">Request Loan</button>
    <br><br>

    <h3>Fund Loan</h3>
    Loan ID: <input id="loanIdFund" type="text"><br>
    Amount to send (wei): <input id="fundAmount" type="text"><br>
    <button onclick="fundLoan()">Fund Loan</button>
    <br><br>

    <h3>Repay Loan</h3>
    Loan ID: <input id="loanIdRepay" type="text"><br>
    Amount to send (wei): <input id="repayAmount" type="text"><br>
    <button onclick="repayLoan()">Repay Loan</button>
    <br><br>

    <h3>Get Loan Details</h3>
    Loan ID: <input id="loanIdGet" type="text"><br>
    <button onclick="getLoan()">Get Loan</button>
    <p id="loanDetails"></p>

    <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.umd.min.js"></script>
    <script>
        let provider;
        let signer;
        let contract;

        const contractAddress = "<YOUR_CONTRACT_ADDRESS>"; // replace
        const abi = <YOUR_CONTRACT_ABI>; // replace

        async function connect() {
            if (window.ethereum) {
                await window.ethereum.request({ method: "eth_requestAccounts" });
                provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();
                contract = new ethers.Contract(contractAddress, abi, signer);

                const address = await signer.getAddress();
                document.getElementById("account").innerText = "Connected: " + address;
            } else {
                alert("MetaMask not detected");
            }
        }

        async function requestLoan() {
            const amount = document.getElementById("amount").value;
            const interest = document.getElementById("interest").value;
            const duration = document.getElementById("duration").value;
            try {
                const tx = await contract.requestLoan(amount, interest, duration);
                await tx.wait();
                alert("Loan requested!");
            } catch (e) {
                console.error(e);
                alert("Error: " + e.message);
            }
        }

        async function fundLoan() {
            const loanId = document.getElementById("loanIdFund").value;
            const fundAmount = document.getElementById("fundAmount").value;
            try {
                const tx = await contract.fundLoan(loanId, { value: fundAmount });
                await tx.wait();
                alert("Loan funded!");
            } catch (e) {
                console.error(e);
                alert("Error: " + e.message);
            }
        }

        async function repayLoan() {
            const loanId = document.getElementById("loanIdRepay").value;
            const repayAmount = document.getElementById("repayAmount").value;
            try {
                const tx = await contract.repayLoan(loanId, { value: repayAmount });
                await tx.wait();
                alert("Loan repaid!");
            } catch (e) {
                console.error(e);
                alert("Error: " + e.message);
            }
        }

        async function getLoan() {
            const loanId = document.getElementById("loanIdGet").value;
            try {
                const loan = await contract.getLoan(loanId);
                document.getElementById("loanDetails").innerText =
                    "Loan ID: " + loan[0] +
                    "\nBorrower: " + loan[1] +
                    "\nLender: " + loan[2] +
                    "\nAmount: " + loan[3] +
                    "\nInterest: " + loan[4] +
                    "\nDuration: " + loan[5] +
                    "\nStart Time: " + loan[6] +
                    "\nStatus: " + loan[7];
            } catch (e) {
                console.error(e);
                alert("Error: " + e.message);
            }
        }
    </script>
</body>
</html>
